<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="UTF-8" />
        <title>Kontrast-Anpassung mit OpenCV.js</title>
        <script async src="https://docs.opencv.org/4.x/opencv.js"></script>
        <style>
            canvas {
                border: 1px solid #ccc;
                margin-top: 10px;
                transform: scale(0.5);
                transform-origin: top left;
            }
            label {
                display: block;
                margin-top: 10px;
            }
        </style>
    </head>
    <body>
        <h2>Kontrast- und Helligkeitseinstellung</h2>
        <input type="file" id="fileInput" />

        <label>
            Kontrast (alpha): <span id="alphaVal">1.5</span>
            <input
                type="range"
                id="alphaSlider"
                min="0.5"
                max="3.0"
                step="0.1"
                value="1.5"
            />
        </label>
        <label>
            Helligkeit (beta): <span id="betaVal">20</span>
            <input
                type="range"
                id="betaSlider"
                min="-200"
                max="100"
                step="5"
                value="20"
            />
        </label>

        <canvas id="outputCanvas"></canvas>

        <script>
            let img = null;
            const canvas = document.getElementById("outputCanvas");
            const alphaSlider = document.getElementById("alphaSlider");
            const betaSlider = document.getElementById("betaSlider");
            const alphaVal = document.getElementById("alphaVal");
            const betaVal = document.getElementById("betaVal");
            const fileInput = document.getElementById("fileInput");

            function updateImage() {
                if (!img) return;
                let src = cv.imread(img);
                let gray = new cv.Mat();
                let dst = new cv.Mat();

                // Graustufen
                cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY);

                // Kontrast + Helligkeit anwenden
                let alpha = parseFloat(alphaSlider.value);
                let beta = parseInt(betaSlider.value);
                gray.convertTo(dst, -1, alpha, beta);

                // Anzeigen
                cv.imshow(canvas, dst);

                // Cleanup
                src.delete();
                gray.delete();
                dst.delete();
            }

            fileInput.addEventListener("change", (e) => {
                const file = e.target.files[0];
                if (!file) return;
                img = new Image();
                img.onload = async () => {
                    cv = cv instanceof Promise ? await cv : cv;

                    canvas.width = img.width;
                    canvas.height = img.height;
                    updateImage();
                };
                img.src = URL.createObjectURL(file);
            });

            alphaSlider.addEventListener("input", () => {
                alphaVal.textContent = alphaSlider.value;
                updateImage();
            });

            betaSlider.addEventListener("input", () => {
                betaVal.textContent = betaSlider.value;
                updateImage();
            });
        </script>
    </body>
</html>
